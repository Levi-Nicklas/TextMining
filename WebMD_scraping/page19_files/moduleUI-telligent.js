/* repo: newsletter/HEAD@c7f02d9 - Package Version: 2.12.0 - 2020-02-27 01:15 pm - User:  */
define(["newsletter/1/service","input_label/1/input_label"],function(e){var t;return t={selector:"#moduleID",nl:36,promo:!0,template:{content:'<div class="nls-header">{header}</div>\n{preContent}<div class="nls-content">\n{preForm}<form class="nls-form" action="#" novalidate="novalidate">\n<div class="validationWrapper"><div class="checkbox-container clearfix">{inputs}</div></div>\n<div class="input-container">\n<div class="email-container validationWrapper">\n<input type="email" class="nls-email" name="email" autocapitalize="off" autocorrect="off" placeholder="Enter email address" /> <button name="nl-submit" formnovalidate class="off {submitClass}" type="submit"><span>Submit</span></button>\n<div class="clearfix"></div></div>\n</div>\n</form>\n<div class="privacy-disclaimer">By clicking Submit, I agree to the WebMD <a href="/about-webmd-policies/about-terms-and-conditions-of-use">Terms & Conditions</a> & <a href="/about-webmd-policies/about-privacy-policy">Privacy Policy</a> and understand that I may opt out of WebMD subscriptions at any time.</div>{postForm}</div>\n{postContent}',header:"<h2>Subscribe... <span>{title} Newsletter</span></h2>",headerMulti:"<h2>Subscribe <span>to WebMD Newsletters</span></h2>",inputSingle:'<input type="hidden" name="nls" value="{id}">',inputMulti:'<label><input type="checkbox" name="nls" class="multi-checkbox" value="{id}">{title}</label>',downtime:"<p>This feature is currently unavailable. The site is undergoing routine maintenance and will be back shortly.</p>",loading:'<div class="loading"><div class="loading_medium_png"><span>Loading...</span></div></div>',successHeader:"<h2>Thank You.</h2>",successMsg:'<p class="success"><span>{email}</span> is now subscribed.</p>',failure:'<div class="failure"><p>This feature is temporarily unavailable.</p><p>Please visit our <a href="{url}">Newsletter Preference Center</a> for all of our available subscription offerings.</p>',readonly:'<div class="failure"><p>This feature is temporarily unavailable.</p><p>Please try again later.</p>',promo:'<div class="promo"><div class="promo-content clearfix"><img src="{image}" alt="WebMD App" /><div class="promo-description"><p>{text}</p><p><a href="{url}" class="webmd-btn webmd-btn-pr webmd-btn-m" onclick="wmdTrack(\'nlupgrd_sub\')">{button}</a></p><div class="clearfix"></div></div></div></div>',promoMobile:'<a href="{url}" onclick="wmdTrack(\'nlupgrd_sub\')"><div class="promo"><div class="promo-content clearfix"><img src="{image}" alt="WebMD App" /><p>{text}</p></div></div></a>',submitClass:""},metricsModule:"nl-single",metricsModuleMultiple:"nl-multie",newsletterUrl:webmd.substitute("https://member{env}.webmd.com/newsletters/newsletters.aspx",{env:webmd.url.getEnv()}),init:function(e){var t;return t=this,e=e||{},$.extend(!0,t,e),t.el=$(t.selector),t.multiple=$.isArray(t.nl),t.buildModule(),t.vendor=webmd.url.getParam("vendor")||"",t.publisher=webmd.url.getParam("publisher")||"",t.campaign=webmd.url.getParam("campaign")||"",webmd.isDown("reg")?(t.showDowntime(),void 0):(t.initEvents(),void 0)},buildModule:function(){var e,t,i,s,n;n=this,t=n.el,s="",n.multiple?(i=n.template.headerMulti,$.each(n.nl,function(e,t){s+=webmd.substitute(n.template.inputMulti,{id:n.getNewsletterId(t),title:n.getNewsletterTitle(t)},!0)})):(i=webmd.substitute(n.template.header,{title:n.getNewsletterTitle(n.nl)},!0),s=webmd.substitute(n.template.inputSingle,{id:n.getNewsletterId(n.nl),title:n.getNewsletterTitle(n.nl)},!0)),e=webmd.substitute(n.template.content,{header:i,inputs:s,preForm:n.template.preForm,postForm:n.template.postForm,preContent:n.template.preContent,postContent:n.template.postContent,submitClass:n.template.submitClass},!0),t.addClass("nls-module").html(e),n.dom={heading:t.find(".nls-header"),content:t.find(".nls-content"),form:t.find(".nls-form"),inputContainer:t.find(".input-container"),privacyDisclaimer:t.find(".privacy-disclaimer"),checkboxContainer:t.find(".checkbox-container"),inputEmail:t.find("input[name=email]"),inputNlId:t.find("input[type=hidden][name=nls]"),inputCheckboxes:t.find("input:checkbox[name=nls]"),button:t.find("button[name=nl-submit]")},n.resize()},initEvents:function(){var e;e=this,e.dom.button.on("click",function(t){t.preventDefault(),e.submit()}),e.dom.inputEmail.one("focus",function(){e.showPrivacyDisclaimer()}),e.dom.inputEmail.on("blur",function(){return setTimeout(function(){e.validateEmail()},200),!0}),e.dom.inputCheckboxes.on("change",function(){e.validateNewsletter()}),e.dom.inputEmail.webmdInputLabel({label:e.dom.inputEmail.attr("placeholder")})},validate:function(){var e,t;return t=this,e=t.validateEmail(),e=t.validateNewsletter()&&e},validatePrivacy:function(){return this.dom.inputPrivacy.is(":checked")?(this.validationMessage(this.dom.inputPrivacy),!0):(this.validationMessage(this.dom.inputPrivacy,"Please acknowledge your agreement"),!1)},validateEmail:function(){var e,t;return e=this.dom.inputEmail.val(),t=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,0===e.length?(this.validationMessage(this.dom.inputEmail,"Please enter your email address"),!1):!t.test(e)||this.dom.inputEmail.webmdInputLabel("isLabel")?(this.validationMessage(this.dom.inputEmail,"Enter a valid email address"),!1):(this.validationMessage(this.dom.inputEmail),!0)},validateNewsletter:function(){if(this.multiple){if(0===this.getSelectedNewsletters().length)return this.validationMessage(this.dom.checkboxContainer,"Please select a newsletter"),!1;this.validationMessage(this.dom.checkboxContainer)}return!0},stylePrivacyCheckbox:function(){this.dom.inputPrivacyLabel.toggleClass("checked",this.dom.inputPrivacy.is(":checked"))},submit:function(){var t,i,s;s=this,s.validate()&&(t=s.dom.inputEmail.val(),s.email=t,i=s.getSelectedNewsletters(),s.dom.content.html(s.template.loading),e.subscribe({email:t,privacy:!0,vendor:s.vendor,publisher:s.publisher,campaign:s.campaign,id:i}).done(function(e){var n;s.multiple?(n=s.metricsModuleMultiple,n+="_"+i.length+"-"+s.nl.length,wmdPageLink(n)):wmdPageLink(s.metricsModule),s.usertype=webmd.object.get("d.usertype",e),s.el.removeClass("error").addClass("confirmed"),s.dom.privacyDisclaimer.hide(),s.dom.heading.html(s.template.successHeader),s.dom.content.html(webmd.substitute(s.template.successMsg,{email:t})),s.resize(),s.promo&&s.buildPromo()}).fail(function(e,t){"readonly"===t?s.dom.content.html(s.template.readonly):s.dom.content.html(webmd.substitute(s.template.failure,{url:s.newsletterUrl})),s.resize()}))},buildPromo:function(){var t,i;t=this,i=Boolean(-1!=location.href.indexOf(".m.")),e.getPromo({id:t.getSelectedNewsletters(!0),mobile:i}).done(function(s){var n,a,o;if(!s.url){if(i||"Full"===t.usertype)return webmd.debug("No promo available."),!1;s=e.promoDefault}i?(o=t.template.promoMobile,n=e.urlGetPromoImg+"hd_"+s.image):(o=t.template.promo,n=e.urlGetPromoImg+s.image),a=webmd.substitute(o,{url:s.url,image:n,text:s.description,button:s.button}),s.email=t.email,"Light"===t.usertype&&(a=$(a).on("click","a",function(){return e.gotoPromo(s),!1})),t.dom.content.append(a),t.resize()}).fail(function(){webmd.debug("Promo build failed.")})},showDowntime:function(){var e;webmd.debug("Registration is down."),e=this,e.dom.content.addClass("downtime").html(e.template.downtime),e.resize()},showPrivacyDisclaimer:function(){this.dom.privacyDisclaimer.show()},resizeEvent:"newsletterResize",resize:function(){this.el.trigger(this.resizeEvent)},getNewsletterTitle:function(t){var i;return i=$.isPlainObject(t)?t.title||e.getName(t.id):e.getName(t),i||"Newsletter"},getNewsletterId:function(e){return $.isPlainObject(e)?e.id||"":e||""},getSelectedNewsletters:function(e){var t;return e&&this.selectedCache?this.selectedCache:(t=[],this.dom.inputCheckboxes.filter(":checked").each(function(){t.push($(this).val())}),this.dom.inputNlId.length&&t.push(this.dom.inputNlId.val()),this.selectedCache=t,t)},validationMessage:function(e,t){var i,s,n;i={wrapper:"validationWrapper",msg:"validationMessage",content:"validationMessageContent",error:"validationError"},n=$(e).closest("."+i.wrapper),0!==n.length&&(s=n.find("."+i.msg),t?(n.addClass(i.error),0===s.length&&(s=$('<div class="'+i.msg+'">'+'<div class="'+i.content+'"></div>'+"</div>").appendTo(n)),s.find("."+i.content).html(t),s.show()):(n.removeClass(i.error),s.hide()),this.resize())}}});